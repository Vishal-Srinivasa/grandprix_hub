<!DOCTYPE html>
<html>
<head>
    <title>Table Input Form</title>
    <style>
        .form-container {
            width: 50%;
            margin: auto;
            padding: 20px;
        }
        .form-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        label {
            font-size: 18px;
            width: 40%;
        }
        input[type="text"] {
            width: 50%;
            padding: 5px;
        }
        button {
            font-size: 16px;
            padding: 10px 20px;
            background-color: #E22420;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>Table Input Form</h2>
        <div id="form"></div>
        <button onclick="submitFormData()">Submit</button>
    </div>

    <script>
        // Fetch column names from the backend
        async function loadForm(tableName) {
            const response = await fetch(`/get_columns?table=${tableName}`);
            const data = await response.json();

            const formContainer = document.getElementById('form');
            formContainer.innerHTML = ''; // Clear existing form elements

            data.columns.forEach(column => {
                const formRow = document.createElement('div');
                formRow.className = 'form-row';

                const label = document.createElement('label');
                label.textContent = column;

                const input = document.createElement('input');
                input.type = 'text';
                input.name = column; // Use column name as the input name attribute

                formRow.appendChild(label);
                formRow.appendChild(input);
                formContainer.appendChild(formRow);
            });
        }

        // Load form when page loads
        document.addEventListener("DOMContentLoaded", function() {
            const tableName = "example_table";  // Replace with dynamic table name if needed
            loadForm(tableName);
        });

        // Submit form data
        async function submitFormData() {
            const formContainer = document.getElementById('form');
            const inputs = formContainer.querySelectorAll('input');
            const formData = {};

            inputs.forEach(input => {
                formData[input.name] = input.value;
            });

            const response = await fetch('/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            alert(result.message);
            console.log(result.data);  // Log the received data
        }
    </script>
</body>
</html>
